# 上方無限ロール

上方無限ロール`nUx`はダイスの振り足しを行うことで、何個のダイスグループが条件を満たすことができるか調べるコマンドです。

ダイス1つを振り、その出目が閾値より大きければダイスを振り足す、を閾値未満の出目が出るまで繰り返します。
これらのダイスの集合をダイスグループと呼びます。
ダイスグループごとに合計値を求めて目標値を比較し、成功した数を表示します。

コマンドの形式は以下の通りです。

```
aUx+nUm+...+xUy[振り足し]+修正値>=目標値
aUx+nUm+...+xUy+修正値>=目標値@振り足し
```

## 実行例

```
[DiceBot]> 2U4+1U6[4]>=6
(2U4+1U6[4]>=6) ＞ 5[4,1],15[4,4,4,3],3 ＞ 成功数1
```

上記コマンドでは4面ダイス2個、6面ダイス1個を使い、振り足しの条件は4以上、成功の条件は6以上となっています。
ダイスロールの結果を細かく分解すると以下のようになっています。

```
4面a: 5[4,1]
4面b: 15[4,4,4,3]
6面: 3
```

`4面a`は1回目の出目が4以上だったので振り足しが行われ、2回目は1だったのでそこで終了し、合計5となりました。
`4面b`は1回目の出目が4以上だったので振り足しが行われ、その後も4が続き、合計15となりました。
`6面`は出目が3で振り足し条件を満たさなかったため、振り足しが行われませんでした。

各ダイスグループの合計と成功条件`>=6`を比較すると、条件に合致するのは`4面b`1つであるため、成功数1と表示されました。

## 振り直しの閾値
ダイス目が`[]`か`@`で指定された数以上であればダイスの振り足しが行われます。

`[]`はダイスの末尾に書きます

```
2U6[4]>=10
```

`@`は式の末尾に書きます

```
2U6>=10@4
```

閾値が明示されていない場合、ゲームシステムに設定されたデフォルト値を参照します。
```
2U6>=10
```

#### 閾値の制限

閾値は2以上としてください。1以下だと常に振り足し条件を満たしてしまい、無限ループ防止のためエラーとなります。

```
[DiceBot]> 2U4[1]>=6
(2U4[1]>=6) ＞ 無限ロールの条件がまちがっています
```


## 修正値

修正値は各ダイスグループに1回のみ加算されます。

```
[DiceBot]> 2U4+1U6[4]+2>=6
(2U4+1U6[4]>=6) ＞ 5[4,1],15[4,4,4,3],3+2 ＞ 成功数2
```

#### 修正値の適用過程

```
4面a: 5[4,1]+2 -> 7 -> 成功
4面b: 15[4,4,4,3]+2 -> 17 -> 成功
6面: 3+2 -> 5 -> 失敗
```


## 比較記号

比較は他のコマンドと同様に以下の記号を指定できます

| 記号 | 意味 |
| :----- | :----- |
| `>=` | 以上 |
| `>` | より大きい |
| `<` | 未満 |
| `<=` | 以下 |
| `==`, `=` | 等しい |
| `!=`, `<>` | 異なる |

## 目標値の省略

比較記号と目標値を省略した場合、ダイスの最大値と、全てのダイスの合計値が出力されます。
合計値の算出では修正値は全体で一回のみ加算されます。

```
[DiceBot]> 2U4+1U6[4]+10
(2U4+1U6[4]+10) ＞ 9[4,4,1],1,13[4,6,3]+10 ＞ 23/33(最大/合計)
```

#### 最大値の算出過程
```
9[4,4,1]+10 -> 19
1+10 -> 11
13[4,6,3]+10 -> 23 -> 最大値
```

#### 合計値の算出過程
```
[4,4,1] + 1 + [4,6,3] + 10 -> 33
```
