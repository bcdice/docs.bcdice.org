# 個数振り足しダイス

ダイスロールを行い、条件を満たした出目の個数だけ追加でダイスロールします。
振り足しがなくなるまで追加のダイスロールを続けます。
その後、成功条件を満たす出目の個数を調べ、成功数を表示します。

コマンドの形式は以下の通りです。

```
aRx+nRm+...+xRy[>=振り足し]>=目標値
aRx+nRm+...+xRy>=目標値@>=振り足し
```

## 実行例

```
[DiceBot]> 2R6+1R10[>3]>=5
(2R6+1R10[>3]>=5) ＞ 5,6 + 9 + 5,4 + 1 + 1,3 ＞ 成功数4
```

上記コマンドでは6面ダイス2個、10面ダイス1個を使い、振り足しの条件は3より大きいこと、成功の条件は5以上となっています。
ダイスロールの結果を細かく分解すると以下のようになっています。

```
2R6  -> [5,6] [5,4] [1,3]
1R10 -> [9] [1]
```

最初ダイスロールを行い、3より大きい出目があれば追加でダイスロールを行います。追加のダイスに対しても同様の判定を行い、ダイスをさらに追加します。
追加が終了したら全ての出目を見て、成功条件と比べます。上記の場合、5以上の出目は 5,6,5,9 の4つなので、成功数4となります。

## 比較記号

成功条件と振り足し条件の比較は他のコマンドと同様に以下の記号を指定できます。

| 記号 | 意味 |
| :----- | :----- |
| `>=` | 以上 |
| `>` | より大きい |
| `<` | 未満 |
| `<=` | 以下 |
| `==`, `=` | 等しい |
| `!=`, `<>` | 異なる |

## 振り足しの閾値

### 制限

下記のように、振り足しの条件を常に満たしてしまう指定は無限ループ防止のためエラーとなります。

```
[DiceBot]> 2R6[>=1]>=4
2R6[>=1]>=4 ＞ 条件が間違っています。2R6>=5 あるいは 2R6[5] のように振り足し目標値を指定してください。
```

### 省略
比較記号を省略した場合、目標値の比較記号が流用されます。下記2つは同じ動作になります
```
2R6[3]>=5
2R6[>=3]>=5
```

閾値指定を省略した場合、目標値の値と比較記号が流用されます。 下記2つは同じ動作になります
```
2R6>=5
2R6[>=5]>=5
```


## 目標値の省略

目標値は省略できますが、成功数0と表示されます。

```
[DiceBot]> 2R6+1R10[>3]
(2R6+1R10[>3]) ＞ 4,6 + 6 + 3,2 + 3 ＞ 成功数0
```

ゲームシステムによってはデフォルトの目標値が設定されている場合があります。
例えば、`ShadowRun4`では`>=5`がデフォルトの目標値となっています。
```
[ShadowRun4]> 2R6+1R10[>3]
(2R6+1R10[>3]>=5) ＞ 3,4 + 10 + 5 + 8 + 2 + 9 + 8 + 2 ＞ 成功数5
```